-- loader.lua
local base64Encoded = [[
bG9jYWwgREJHPXRydWUKbG9jYWwgY2ZnRmlsZT0iY29uZmlnIgpsb2NhbCBjZmc9ewogd2hpdGVsaXN0PXt9LAogcHVsc2VNb2I9dHJ1ZSwKIHB1bHNlUGxheWVyPXRydWUsCiByYWRhck1vZGU9ZmFsc2UsCiBkaXNjb3JkRW5hYmxlZD10cnVlLAogd2ViaG9va1VSTD0iaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MveW91cl93ZWJob29rX2hlcmUiLAogYm90TmFtZT0iQmFzZSBEZWZlbmNlIEJvdCIsCiBib3RBdmF0YXI9bmlsLAogZGlzY29yZENoYW5uZWw9InlvdXJfY2hhbm5lbF9pZF9oZXJlIiwKIGJvdFRva2VuPSJ5b3VyX2JvdF90b2tlbl9oZXJlIiwKIG9yaWdpbj17eD0wLHk9MCx6PTB9LAogcmFkYXJSb3RhdGlvbj0wLAogZGlzcGxheVdoaXRlbGlzdGVkT25SYWRhcj10cnVlCn0KCmxvY2FsIGZ1bmN0aW9uIGxvYWRDZmcoKQogaWYgZnMuZXhpc3RzKGNmZ0ZpbGUpIHRoZW4KICBsb2NhbCBmPWZzLm9wZW4oY2ZnRmlsZSwiciIpCiAgbG9jYWwgYz1mLnJlYWRBbGwoKQogIGYuY2xvc2UoKQogIGxvY2FsIHQ9dGV4dHV0aWxzLnVuc2VyaWFsaXplKGMpCiAgaWYgdCB0aGVuIGNmZz10IGVuZAogZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gc2F2ZUNmZygpCiBsb2NhbCBmPWZzLm9wZW4oY2ZnRmlsZSwidyIpCiBmLndyaXRlKHRleHR1dGlscy5zZXJpYWxpemUoY2ZnKSkKIGYuY2xvc2UoKQplbmQKCmxvYWRDZmcoKQoKbG9jYWwgZnVuY3Rpb24gcHJvbXB0KCkKIGxvY2FsIG5lZWQ9ZmFsc2UKIGlmIG5vdCBjZmcuZGlzY29yZENoYW5uZWwgb3IgY2ZnLmRpc2NvcmRDaGFubmVsPT0iIiBvciBjZmcuZGlzY29yZENoYW5uZWw9PSJ5b3VyX2NoYW5uZWxfaWRfaGVyZSIgdGhlbiBuZWVkPXRydWUgZW5kCiBpZiBub3QgY2ZnLmJvdFRva2VuIG9yIGNmZy5ib3RUb2tlbj09IiIgb3IgY2ZnLmJvdFRva2VuPT0ieW91cl9ib3RfdG9rZW5faGVyZSIgdGhlbiBuZWVkPXRydWUgZW5kCiBpZiBub3QgY2ZnLndlYmhvb2tVUkwgb3IgY2ZnLndlYmhvb2tVUkw9PSIiIG9yIGNmZy53ZWJob29rVVJMPT0iaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MveW91cl93ZWJob29rX2hlcmUiIHRoZW4gbmVlZD10cnVlIGVuZAogaWYgbmVlZCB0aGVuCiAgcHJpbnQoIj09PSBEaXNjb3JkIFNldHVwID09PSIpCiAgcHJpbnQoIkVudGVyIERpc2NvcmQgY2hhbm5lbCBJRCwgYm90IHRva2VuLCBhbmQgd2ViaG9vayBVUkwuIikKICBpZiBub3QgY2ZnLmRpc2NvcmRDaGFubmVsIG9yIGNmZy5kaXNjb3JkQ2hhbm5lbD09IiIgb3IgY2ZnLmRpc2NvcmRDaGFubmVsPT0ieW91cl9jaGFubmVsX2lkX2hlcmUiIHRoZW4KICAgd3JpdGUoIkRpc2NvcmQgY2hhbm5lbCBJRDogIikKICAgY2ZnLmRpc2NvcmRDaGFubmVsPXJlYWQoKQogIGVuZAogIGlmIG5vdCBjZmcuYm90VG9rZW4gb3IgY2ZnLmJvdFRva2VuPT0iIiBvciBjZmcuYm90VG9rZW49PSJ5b3VyX2JvdF90b2tlbl9oZXJlIiB0aGVuCiAgIHdyaXRlKCJEaXNjb3JkIGJvdCB0b2tlbjogIikKICAgY2ZnLmJvdFRva2VuPXJlYWQoKQogIGVuZAogIGlmIG5vdCBjZmcud2ViaG9va1VSTCBvciBjZmcud2ViaG9va1VSTD09IiIgb3IgY2ZnLndlYmhvb2tVUkw9PSJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy95b3VyX3dlYmhvb2tfaGVyZSIgdGhlbgogICB3cml0ZSgiRGlzY29yZCB3ZWJob29rIFVSTDogIikKICAgY2ZnLndlYmhvb2tVUkw9cmVhZCgpCiAgZW5kCiAgc2F2ZUNmZygpCiAgcHJpbnQoIlNldHRpbmdzIHNhdmVkLiBSZXN0YXJ0IGlmIG5lZWRlZC5cbiIpCiBlbmQKZW5kCgpwcm9tcHQoKQpsb2FkQ2ZnKCkKCmxvY2FsIG1hbmlwPXBlcmlwaGVyYWwuZmluZCgibWFuaXB1bGF0b3IiKQppZiBub3QgbWFuaXAgdGhlbiBlcnJvcigiTm8gbWFuaXB1bGF0b3IiKSBlbmQKaWYgbm90IG1hbmlwLmhhc01vZHVsZSgicGxldGhvcmE6c2Vuc29yIikgdGhlbiBlcnJvcigiTm8gc2Vuc29yIG1vZHVsZSIpIGVuZAoKbG9jYWwgZnVuY3Rpb24gc2NhbigpIHJldHVybiBtYW5pcC5zZW5zZSgpIGVuZApsb2NhbCBmdW5jdGlvbiBnZXRNZXRhKGUpIGlmIGUgYW5kIGUuaWQgdGhlbiByZXR1cm4gbWFuaXAuZ2V0TWV0YUJ5SUQoZS5pZCkgZW5kIHJldHVybiBuaWwgZW5kCgpsb2NhbCBtb249cGVyaXBoZXJhbC5maW5kKCJtb25pdG9yIikKaWYgbm90IG1vbiB0aGVuIGVycm9yKCJObyBtb25pdG9yIikgZW5kCmlmIG5vdCByZWRzdG9uZSB0aGVuIGVycm9yKCJObyByZWRzdG9uZSBBUEkiKSBlbmQKCmxvY2FsIEhvb2s9cmVxdWlyZSgiRGlzY29yZEhvb2siKQpsb2NhbCBvayxob29rT2JqPUhvb2suY3JlYXRlV2ViaG9vayhjZmcud2ViaG9va1VSTCkKaWYgbm90IG9rIHRoZW4gZXJyb3IoIldlYmhvb2sgZmFpbDogIi4uaG9va09iaikgZW5kCgpsb2NhbCBmdW5jdGlvbiBzZW5kTXNnKG0pCiBpZiBjZmcuZGlzY29yZEVuYWJsZWQgdGhlbgogIGxvY2FsIHMsZXI9cGNhbGwoZnVuY3Rpb24oKQogICBob29rT2JqLnNlbmQobSxjZmcuYm90TmFtZSxjZmcuYm90QXZhdGFyKQogIGVuZCkKICBpZiBEQkcgYW5kIG5vdCBzIHRoZW4gcHJpbnQoIkRCRzogRXJyb3IgdG8gRGlzY29yZDogIi4udG9zdHJpbmcoZXIpKSBlbmQKIGVuZAplbmQKCmxvY2FsIHByb2Nlc3NDbWQKbG9jYWwgbGFzdElEPW5pbApsb2NhbCBsYXN0UmF3PSIiCgpsb2NhbCBmdW5jdGlvbiBwb2xsRGlzY29yZCgpCiB3aGlsZSB0cnVlIGRvCiAgbG9jYWwgdXJsPSJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS9jaGFubmVscy8iLi5jZmcuZGlzY29yZENoYW5uZWwuLiIvbWVzc2FnZXM/bGltaXQ9NSIKICBpZiBsYXN0SUQgdGhlbiB1cmw9dXJsLi4iJmFmdGVyPSIuLmxhc3RJRCBlbmQKICBsb2NhbCBoPXsKICAgWyJBdXRob3JpemF0aW9uIl09IkJvdCAiLi5jZmcuYm90VG9rZW4sCiAgIFsiVXNlci1BZ2VudCJdPSJEaXNjb3JkQm90IChDb21wdXRlckNyYWZ0KSIKICB9CiAgbG9jYWwgcj1odHRwLmdldCh1cmwsaCkKICBpZiByIHRoZW4KICAgbG9jYWwgYj1yLnJlYWRBbGwoKQogICBsYXN0UmF3PWIKICAgci5jbG9zZSgpCiAgIGxvY2FsIHNjLG1zZ3M9cGNhbGwodGV4dHV0aWxzLnVuc2VyaWFsaXplSlNPTixiKQogICBpZiBzYyBhbmQgdHlwZShtc2dzKT09InRhYmxlIiB0aGVuCiAgICBsb2NhbCB0b1A9e30KICAgIGZvciBpPSNtc2dzLDEsLTEgZG8KICAgICBsb2NhbCBtPW1zZ3NbaV0KICAgICBpZiBub3QgbS5hdXRob3IuYm90IHRoZW4gdGFibGUuaW5zZXJ0KHRvUCxtKSBlbmQKICAgICBpZiAobm90IGxhc3RJRCkgb3IgKHRvbnVtYmVyKG0uaWQpPnRvbnVtYmVyKGxhc3RJRCkpIHRoZW4gbGFzdElEPW0uaWQgZW5kCiAgICBlbmQKICAgIGZvciBfLG1tIGluIGlwYWlycyh0b1ApIGRvCiAgICAgbG9jYWwgYz1tbS5jb250ZW50OmdzdWIoIl4lcyooLi0pJXMqJCIsIiUxIikKICAgICBpZiBEQkcgdGhlbiBwcmludCgiREJHOiBEaXNjb3JkIGNtZCAtPiBbIi4uYy4uIl0iKSBlbmQKICAgICBwcm9jZXNzQ21kKGMsImRpc2NvcmQiKQogICAgZW5kCiAgIGVsc2UKICAgIGlmIERCRyB0aGVuIHByaW50KCJEQkc6IGRlY29kZSBlcnJvciIpIGVuZAogICBlbmQKICBlbHNlCiAgIGlmIERCRyB0aGVuIHByaW50KCJEQkc6IHBvbGwgZmFpbCIpIGVuZAogIGVuZAogIHNsZWVwKDMpCiBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBkaXN0KHgseSx6KSByZXR1cm4gbWF0aC5zcXJ0KHgqeCt5Knkreip6KSBlbmQKCmxvY2FsIGZ1bmN0aW9uIHB1bHNlKHQpCiBpZiB0PT0ibW9iIiBhbmQgY2ZnLnB1bHNlTW9iIHRoZW4KICByZWRzdG9uZS5zZXRPdXRwdXQoImxlZnQiLHRydWUpCiAgc2xlZXAoMC41KQogIHJlZHN0b25lLnNldE91dHB1dCgibGVmdCIsZmFsc2UpCiBlbHNlaWYgdD09InBsYXllciIgYW5kIGNmZy5wdWxzZVBsYXllciB0aGVuCiAgcmVkc3RvbmUuc2V0T3V0cHV0KCJyaWdodCIsdHJ1ZSkKICBzbGVlcCgwLjUpCiAgcmVkc3RvbmUuc2V0T3V0cHV0KCJyaWdodCIsZmFsc2UpCiBlbmQKZW5kCgpwcm9jZXNzQ21kPWZ1bmN0aW9uKGNtZCxzcmMpCiBsb2NhbCBjLHI9Y21kOm1hdGNoKCJeKCVTKyklcyooLiopJCIpCiBjPWMgYW5kIGM6bG93ZXIoKSBvciAiIgogcj1yIG9yICIiCiBpZiBEQkcgdGhlbiBwcmludCgiREJHOiBwcm9jZXNzQ21kIC0+IGNvbW1hbmQ9WyIuLmMuLiJdLCByZXN0PVsiLi5yLi4iXSwgc291cmNlPVsiLi5zcmMuLiJdIikgZW5kCiBpZiBjPT0iYWRkd2hpdGVsaXN0IiB0aGVuCiAgaWYgcn49IiIgdGhlbgogICBjZmcud2hpdGVsaXN0W3JdPXRydWUKICAgc2F2ZUNmZygpCiAgIGlmIHNyYz09ImRpc2NvcmQiIHRoZW4gc2VuZE1zZygiV2hpdGVsaXN0IHVwZGF0ZWQ6IGFkZGVkICIuLnIpIGVuZAogIGVsc2UgcHJpbnQoIlVzYWdlOiBhZGR3aGl0ZWxpc3QgPG5hbWU+IikgZW5kCiBlbHNlaWYgYz09InJlbW92ZXdoaXRlbGlzdCIgdGhlbgogIGlmIHJ+PSIiIHRoZW4KICAgY2ZnLndoaXRlbGlzdFtyXT1uaWwKICAgc2F2ZUNmZygpCiAgIGlmIHNyYz09ImRpc2NvcmQiIHRoZW4gc2VuZE1zZygiV2hpdGVsaXN0IHVwZGF0ZWQ6IHJlbW92ZWQgIi4ucikgZW5kCiAgZWxzZSBwcmludCgiVXNhZ2U6IHJlbW92ZXdoaXRlbGlzdCA8bmFtZT4iKSBlbmQKIGVsc2VpZiBjPT0idG9nZ2xlcHVsc2UiIHRoZW4KICBsb2NhbCB3PXI6bG93ZXIoKQogIGlmIHc9PSJtb2IiIHRoZW4KICAgY2ZnLnB1bHNlTW9iPW5vdCBjZmcucHVsc2VNb2IKICAgc2F2ZUNmZygpCiAgIGlmIHNyYz09ImRpc2NvcmQiIHRoZW4gc2VuZE1zZygiTW9iIHB1bHNlOiAiLi50b3N0cmluZyhjZmcucHVsc2VNb2IpKSBlbmQKICBlbHNlaWYgdz09InBsYXllciIgdGhlbgogICBjZmcucHVsc2VQbGF5ZXI9bm90IGNmZy5wdWxzZVBsYXllcgogICBzYXZlQ2ZnKCkKICAgaWYgc3JjPT0iZGlzY29yZCIgdGhlbiBzZW5kTXNnKCJQbGF5ZXIgcHVsc2U6ICIuLnRvc3RyaW5nKGNmZy5wdWxzZVBsYXllcikpIGVuZAogIGVsc2UgcHJpbnQoIlVzYWdlOiB0b2dnbGVwdWxzZSBtb2J8cGxheWVyIikgZW5kCiBlbHNlaWYgYz09Im92ZXJyaWRlIiB0aGVuCiAgbG9jYWwgdz1yOmxvd2VyKCkKICBpZiB3PT0ibW9iIiB0aGVuCiAgIHB1bHNlKCJtb2IiKQogICBpZiBzcmM9PSJkaXNjb3JkIiB0aGVuIHNlbmRNc2coIk92ZXJyaWRlOiBtb2IgcHVsc2UiKSBlbmQKICBlbHNlaWYgdz09InBsYXllciIgdGhlbgogICBwdWxzZSgicGxheWVyIikKICAgaWYgc3JjPT0iZGlzY29yZCIgdGhlbiBzZW5kTXNnKCJPdmVycmlkZTogcGxheWVyIHB1bHNlIikgZW5kCiAgZWxzZSBwcmludCgiVXNhZ2U6IG92ZXJyaWRlIG1vYnxwbGF5ZXIiKSBlbmQKIGVsc2VpZiBjPT0idG9nZ2xlcmFkYXIiIHRoZW4KICBjZmcucmFkYXJNb2RlPW5vdCBjZmcucmFkYXJNb2RlCiAgc2F2ZUNmZygpCiAgaWYgc3JjPT0iZGlzY29yZCIgdGhlbiBzZW5kTXNnKCJSYWRhciBtb2RlOiAiLi50b3N0cmluZyhjZmcucmFkYXJNb2RlKSkgZW5kCiBlbHNlaWYgYz09InNldG9yaWdpbiIgdGhlbgogIGxvY2FsIHgseSx6PXI6bWF0Y2goIl4oJS0/JWQrKSVzKyglLT8lZCspJXMrKCUtPyVkKykkIikKICBpZiB4IGFuZCB5IGFuZCB6IHRoZW4KICAgY2ZnLm9yaWdpbj17eD10b251bWJlcih4KSx5PXRvbnVtYmVyKHkpLHo9dG9udW1iZXIoeil9CiAgIHNhdmVDZmcoKQogICBpZiBzcmM9PSJkaXNjb3JkIiB0aGVuIHNlbmRNc2coIk9yaWdpbjogKCIuLnguLiIsIi4ueS4uIiwiLi56Li4iKSIpIGVuZAogIGVsc2UgcHJpbnQoIlVzYWdlOiBzZXRvcmlnaW4gPHg+IDx5PiA8ej4iKSBlbmQKIGVsc2VpZiBjPT0ic2V0cm90YXRpb24iIHRoZW4KICBsb2NhbCBhPXRvbnVtYmVyKHIpCiAgaWYgYSBhbmQgKGE9PTAgb3IgYT09OTAgb3IgYT09MTgwIG9yIGE9PTI3MCkgdGhlbgogICBjZmcucmFkYXJSb3RhdGlvbj1hCiAgIHNhdmVDZmcoKQogICBpZiBzcmM9PSJkaXNjb3JkIiB0aGVuIHNlbmRNc2coIlJhZGFyIHJvdGF0aW9uOiAiLi5hKSBlbmQKICBlbHNlIHByaW50KCJVc2FnZTogc2V0cm90YXRpb24gPDB8OTB8MTgwfDI3MD4iKSBlbmQKIGVsc2VpZiBjPT0ic2V0d2ViaG9vayIgdGhlbgogIGlmIHJ+PSIiIHRoZW4KICAgY2ZnLndlYmhvb2tVUkw9cgogICBzYXZlQ2ZnKCkKICAgbG9jYWwgcyxuPUhvb2suY3JlYXRlV2ViaG9vayhjZmcud2ViaG9va1VSTCkKICAgaWYgcyB0aGVuCiAgICBob29rT2JqPW4KICAgIGlmIHNyYz09ImRpc2NvcmQiIHRoZW4gc2VuZE1zZygiV2ViaG9vayB1cGRhdGVkLiIpIGVuZAogICBlbmQKICBlbHNlIHByaW50KCJVc2FnZTogc2V0d2ViaG9vayA8dXJsPiIpIGVuZAogZWxzZWlmIGM9PSJzZXRib3RuYW1lIiB0aGVuCiAgaWYgcn49IiIgdGhlbgogICBjZmcuYm90TmFtZT1yCiAgIHNhdmVDZmcoKQogICBpZiBzcmM9PSJkaXNjb3JkIiB0aGVuIHNlbmRNc2coIkJvdCBuYW1lOiAiLi5yKSBlbmQKICBlbHNlIHByaW50KCJVc2FnZTogc2V0Ym90bmFtZSA8bmFtZT4iKSBlbmQKIGVsc2VpZiBjPT0ibGlzdHNlbnNvciIgdGhlbgogIGxvY2FsIGVuPXNjYW4oKQogIGxvY2FsIG91dD10ZXh0dXRpbHMuc2VyaWFsaXplKGVuKQogIGlmIHNyYz09ImRpc2NvcmQiIHRoZW4gc2VuZE1zZygiU2Vuc29yIERhdGE6ICIuLm91dCkgZWxzZQogICBwcmludCgiU2Vuc29yIERhdGE6IikKICAgcHJpbnQob3V0KQogIGVuZAogZWxzZWlmIGM9PSJsaXN0c2Vuc29ybWV0YSIgdGhlbgogIGxvY2FsIGVuPXNjYW4oKQogIGxvY2FsIHM9IiIKICBmb3IgaSxlIGluIGlwYWlycyhlbikgZG8KICAgbG9jYWwgbT1nZXRNZXRhKGUpCiAgIHM9cy4uIkVudGl0eSAiLi5pLi4iOlxuIgogICBpZiBtIHRoZW4gcz1zLi4odGV4dHV0aWxzLnNlcmlhbGl6ZShtKS4uIlxuIikgZWxzZSBzPXMuLiJObyBtZXRhLlxuIiBlbmQKICBlbmQKICBpZiBzcmM9PSJkaXNjb3JkIiB0aGVuIHNlbmRNc2coIlNlbnNvciBNZXRhOlxuIi4ucykgZWxzZSBwcmludChzKSBlbmQKIGVsc2VpZiBjPT0iZGVidWdkaXNjb3JkIiB0aGVuCiAgaWYgc3JjPT0iZGlzY29yZCIgdGhlbgogICBsb2NhbCBzbj1sYXN0UmF3OnN1YigxLDUxMikKICAgc2VuZE1zZygiRnVsbCBEaXNjb3JkIFJhdyBKU09OIChmaXJzdCA1MTIgY2hhcnMpOiAiLi5zbikKICBlbHNlCiAgIHByaW50KCJMb2NhbCBkZWJ1Z2Rpc2NvcmQ6IikKICAgcHJpbnQoIkZ1bGwgRGlzY29yZCBSYXcgSlNPTjoiKQogICBwcmludChsYXN0UmF3KQogIGVuZAogZWxzZQogIHByaW50KCJVbmtub3duIGNvbW1hbmQ6ICIuLmNtZCkKIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIG1haW5Mb29wKCkKIHdoaWxlIHRydWUgZG8KICBsb2NhbCBlbnQ9c2NhbigpCiAgbG9jYWwgTHN0PXt9CiAgbG9jYWwgUmRyPXt9CiAgZm9yIF8sdiBpbiBpcGFpcnMoZW50KSBkbwogICBsb2NhbCBubT12Lm5hbWUgb3Igdi50eXBlIG9yIlVua25vd24iCiAgIGxvY2FsIHN4PXYueCBvciAwCiAgIGxvY2FsIHN5PXYueSBvciAwCiAgIGxvY2FsIHN6PXYueiBvciAwCiAgIGxvY2FsIGRkPWRpc3Qoc3gsc3ksc3opCiAgIGxvY2FsIHd4PWNmZy5vcmlnaW4ueCtzeAogICBsb2NhbCB3eT1jZmcub3JpZ2luLnkrc3kKICAgbG9jYWwgd3o9Y2ZnLm9yaWdpbi56K3N6CiAgIGxvY2FsIG10PWdldE1ldGEodikKICAgbG9jYWwgZXQ9Im1vYiIKICAgaWYgbXQgYW5kIG10LmZvb2QgYW5kIHR5cGUobXQuZm9vZC5odW5nZXIpPT0ibnVtYmVyIiB0aGVuIGV0PSJwbGF5ZXIiIGVuZAogICBpZiBub3QgY2ZnLndoaXRlbGlzdFtubV0gdGhlbgogICAgbG9jYWwgc3Q9c3RyaW5nLmZvcm1hdCgiJXMgYXQgKCVkLCVkLCVkKSAtICUuMWYgYmxvY2tzIGF3YXkuIixubSx3eCx3eSx3eixkZCkKICAgIHNlbmRNc2coc3QpCiAgICB0YWJsZS5pbnNlcnQoTHN0LHtuYW1lPW5tLHdvcmxkWD13eCx3b3JsZFk9d3ksd29ybGRaPXd6LGRpc3RhbmNlPWRkfSkKICAgIHB1bHNlKGV0KQogICBlbmQKICAgdGFibGUuaW5zZXJ0KFJkcix7bmFtZT1ubSx4PXd4LHo9d3p9KQogIGVuZAogIG1vbi5jbGVhcigpCiAgbW9uLnNldEN1cnNvclBvcygxLDEpCiAgbW9uLndyaXRlKCJFbnRpdHkgQWxlcnQgU3lzdGVtIikKICBpZiBub3QgY2ZnLnJhZGFyTW9kZSB0aGVuCiAgIGxvY2FsIGxpbmU9MgogICBmb3IgXyxlIGluIGlwYWlycyhMc3QpIGRvCiAgICBtb24uc2V0Q3Vyc29yUG9zKDEsbGluZSkKICAgIGxvY2FsIHM9c3RyaW5nLmZvcm1hdCgiJXM6ICglZCwlZCwlZCkgJS4xZiBibG9ja3MiLGUubmFtZSxlLndvcmxkWCxlLndvcmxkWSxlLndvcmxkWixlLmRpc3RhbmNlKQogICAgbW9uLndyaXRlKHMpCiAgICBsaW5lPWxpbmUrMQogICBlbmQKICBlbHNlCiAgIGxvY2FsIHcsaD1tb24uZ2V0U2l6ZSgpCiAgIGxvY2FsIGN4LGN5PW1hdGguZmxvb3Iody8yKSxtYXRoLmZsb29yKGgvMikKICAgbW9uLmNsZWFyKCkKICAgbW9uLnNldEN1cnNvclBvcyhjeCxjeSkKICAgbW9uLndyaXRlKCJPIikKICAgZm9yIF8sZSBpbiBpcGFpcnMoUmRyKSBkbwogICAgbG9jYWwgZHg9ZS54LWNmZy5vcmlnaW4ueAogICAgbG9jYWwgZHo9ZS56LWNmZy5vcmlnaW4uegogICAgbG9jYWwgcngscno9ZHgsZHoKICAgIGlmIGNmZy5yYWRhclJvdGF0aW9uPT05MCB0aGVuIHJ4LHJ6PWR6LC1keAogICAgZWxzZWlmIGNmZy5yYWRhclJvdGF0aW9uPT0xODAgdGhlbiByeCxyej0tZHgsLWR6CiAgICBlbHNlaWYgY2ZnLnJhZGFyUm90YXRpb249PTI3MCB0aGVuIHJ4LHJ6PS1keixkeAogICAgZW5kCiAgICBsb2NhbCB4eD1jeCttYXRoLmZsb29yKHJ4KQogICAgbG9jYWwgeXk9Y3krbWF0aC5mbG9vcihyeikKICAgIGlmIHh4Pj0xIGFuZCB4eDw9dyBhbmQgeXk+PTEgYW5kIHl5PD1oIHRoZW4KICAgICBtb24uc2V0Q3Vyc29yUG9zKHh4LHl5KQogICAgIGxvY2FsIHNtPSIqIgogICAgIGlmIGNmZy53aGl0ZWxpc3RbZS5uYW1lXSB0aGVuIHNtPSJXIiBlbmQKICAgICBtb24ud3JpdGUoc20pCiAgICBlbmQKICAgZW5kCiAgZW5kCiAgc2xlZXAoMSkKIGVuZAplbmQKCnBhcmFsbGVsLndhaXRGb3JBbnkoCiBmdW5jdGlvbigpCiAgd2hpbGUgdHJ1ZSBkbwogICB0ZXJtLndyaXRlKCI+ICIpCiAgIGxvY2FsIGlucD1yZWFkKCkKICAgcHJvY2Vzc0NtZChpbnAsImxvY2FsIikKICBlbmQKIGVuZCwKIHBvbGxEaXNjb3JkTWVzc2FnZXMsCiBtYWluTG9vcAop
]]

-- A small function to decode base64
local function decodeBase64(data)
  local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
  data = string.gsub(data, '[^'..b..'=]', '')
  return (data:gsub('.', function(x)
    if x == '=' then return '' end
    local r,f='',(b:find(x)-1)
    for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
    return r
  end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
    if #x ~= 8 then return '' end
    local c=0
    for i=1,8 do c=c+ (string.sub(x,i,i)=='1' and 2^(8-i) or 0) end
    return string.char(c)
  end))
end

-- Decode the real code
local realCode = decodeBase64(base64Encoded)

-- Now load it as a Lua chunk and run
local fn, err = load(realCode, "decoded", "t", _ENV)
if not fn then
  error("Failed to load decoded code: "..(err or "unknown error"))
end
fn()
