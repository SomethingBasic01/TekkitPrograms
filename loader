-- loader.lua
local base64Encoded = [[
bG9jYWwgRz10cnVlIGxvY2FsIGY9ImNvbmZpZyIgbG9jYWwgZT17d2hpdGVsaXN0PXt9LHB1bHNlTW9iPXRydWUscHVsc2VQbGF5ZXI9dHJ1ZSxyYWRhck1vZGU9ZmFsc2UsZGlzY29yZEVuYWJsZWQ9dHJ1ZSx3ZWJob29rVVJMPSJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy95b3VyX3dlYmhvb2tfaGVyZSIsYm90TmFtZT0iQmFzZSBEZWZlbmNlIEJvdCIsYm90QXZhdGFyPW5pbCxkaXNjb3JkQ2hhbm5lbD0ieW91cl9jaGFubmVsX2lkX2hlcmUiLGJvdFRva2VuPSJ5b3VyX2JvdF90b2tlbl9oZXJlIixvcmlnaW49e3g9MCx5PTAsej0wfSxyYWRhclJvdGF0aW9uPTAsZGlzcGxheVdoaXRlbGlzdGVkT25SYWRhcj10cnVlfSBsb2NhbCBmdW5jdGlvbiBRKClpZiBmcy5leGlzdHMoZil0aGVuIGxvY2FsIGE9ZnMub3BlbihmLCJyIilsb2NhbCBiPWEucmVhZEFsbCgpYS5jbG9zZSgpbG9jYWwgYz10ZXh0dXRpbHMudW5zZXJpYWxpemUoYilpZiBjIHRoZW4gZT1jIGVuZCBlbmQgZW5kIGxvY2FsIGZ1bmN0aW9uIFcoKWxvY2FsIGE9ZnMub3BlbihmLCJ3IilhLndyaXRlKHRleHR1dGlscy5zZXJpYWxpemUoZSkpYS5jbG9zZSgpZW5kIFEoKWxvY2FsIGZ1bmN0aW9uIFQoKWxvY2FsIGE9ZmFsc2UgaWYobm90IGUuZGlzY29yZENoYW5uZWwgb3IgZS5kaXNjb3JkQ2hhbm5lbD09IiJvciBlLmRpc2NvcmRDaGFubmVsPT0ieW91cl9jaGFubmVsX2lkX2hlcmUiKXRoZW4gYT10cnVlIGVuZCBpZihub3QgZS5ib3RUb2tlbiBvciBlLmJvdFRva2VuPT0iIm9yIGUuYm90VG9rZW49PSJ5b3VyX2JvdF90b2tlbl9oZXJlIil0aGVuIGE9dHJ1ZSBlbmQgaWYobm90IGUud2ViaG9va1VSTCBvciBlLndlYmhvb2tVUkw9PSIib3IgZS53ZWJob29rVVJMPT0iaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MveW91cl93ZWJob29rX2hlcmUiKXRoZW4gYT10cnVlIGVuZCBpZiBhIHRoZW4gcHJpbnQoIj09PSBEaXNjb3JkIFNldHVwID09PSIpcHJpbnQoIkl0IHNlZW1zIHRoaXMgaXMgeW91ciBmaXJzdCB0aW1lIG9yIGNvbmZpZyBpcyBpbmNvbXBsZXRlLiIpcHJpbnQoIlBsZWFzZSBlbnRlciB5b3VyIERpc2NvcmQgY2hhbm5lbCBJRCwgYm90IHRva2VuLCBhbmQgd2ViaG9vayBVUkwuXG4iKWlmKG5vdCBlLmRpc2NvcmRDaGFubmVsIG9yIGUuZGlzY29yZENoYW5uZWw9PSIib3IgZS5kaXNjb3JkQ2hhbm5lbD09InlvdXJfY2hhbm5lbF9pZF9oZXJlIil0aGVuIHdyaXRlKCJFbnRlciB5b3VyIERpc2NvcmQgY2hhbm5lbCBJRDogIillLmRpc2NvcmRDaGFubmVsPXJlYWQoKWVuZCBpZihub3QgZS5ib3RUb2tlbiBvciBlLmJvdFRva2VuPT0iIm9yIGUuYm90VG9rZW49PSJ5b3VyX2JvdF90b2tlbl9oZXJlIil0aGVuIHdyaXRlKCJFbnRlciB5b3VyIERpc2NvcmQgYm90IHRva2VuOiAiKWUuYm90VG9rZW49cmVhZCgpZW5kIGlmKG5vdCBlLndlYmhvb2tVUkwgb3IgZS53ZWJob29rVVJMPT0iIm9yIGUud2ViaG9va1VSTD09Imh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzL3lvdXJfd2ViaG9va19oZXJlIil0aGVuIHdyaXRlKCJFbnRlciB5b3VyIERpc2NvcmQgd2ViaG9vayBVUkw6ICIpZS53ZWJob29rVVJMPXJlYWQoKWVuZCBXKClwcmludCgiU2V0dGluZ3Mgc2F2ZWQuIFJlc3RhcnQgaWYgbmVlZGVkLlxuIillbmQgZW5kIFQoKVEoKWxvY2FsIHU9cGVyaXBoZXJhbC5maW5kKCJtYW5pcHVsYXRvciIpaWYgbm90IHUgdGhlbiBlcnJvcigiQ2Fubm90IGZpbmQgbWFuaXB1bGF0b3IiKWVuZCBpZiBub3QgdS5oYXNNb2R1bGUoInBsZXRob3JhOnNlbnNvciIpdGhlbiBlcnJvcigiQ2Fubm90IGZpbmQgZW50aXR5IHNlbnNvciBtb2R1bGUgb24gdGhlIG1hbmlwdWxhdG9yIillbmQgbG9jYWwgZnVuY3Rpb24gWCgpcmV0dXJuIHUuc2Vuc2UoKWVuZCBsb2NhbCBmdW5jdGlvbiBZKGEpaWYgYSBhbmQgYS5pZCB0aGVuIHJldHVybiB1LmdldE1ldGFCeUlEKGEuaWQpZW5kIHJldHVybiBuaWwgZW5kIGxvY2FsIEw9cGVyaXBoZXJhbC5maW5kKCJtb25pdG9yIilpZiBub3QgTCB0aGVuIGVycm9yKCJNb25pdG9yIG5vdCBmb3VuZCEiKWVuZCBpZiBub3QgcmVkc3RvbmUgdGhlbiBlcnJvcigiUmVkc3RvbmUgQVBJIG5vdCBhdmFpbGFibGUhIillbmQgbG9jYWwgUz1yZXF1aXJlKCJEaXNjb3JkSG9vayIpbG9jYWwgVixIPVMuY3JlYXRlV2ViaG9vayhlLndlYmhvb2tVUkwpaWYgbm90IFYgdGhlbiBlcnJvcigiV2ViaG9vayBjb25uZWN0aW9uIGZhaWxlZCEgUmVhc29uOiAiLi5IKWVuZCBsb2NhbCBmdW5jdGlvbiBPKGEpaWYgZS5kaXNjb3JkRW5hYmxlZCB0aGVuIGxvY2FsIGIsYz1wY2FsbChmdW5jdGlvbigpSC5zZW5kKGEsZS5ib3ROYW1lLGUuYm90QXZhdGFyKWVuZClpZiBHIGFuZCBub3QgYiB0aGVuIHByaW50KCJERUJVRzogRXJyb3Igc2VuZGluZyBtZXNzYWdlIHRvIERpc2NvcmQ6ICIuLnRvc3RyaW5nKGMpKWVuZCBlbmQgZW5kIGxvY2FsIGQgbmlsIGxvY2FsIGk9IiIgbG9jYWwgZnVuY3Rpb24gTSgpd2hpbGUgdHJ1ZSBkbyBsb2NhbCBhPSJodHRwczovL2Rpc2NvcmQuY29tL2FwaS92OS9jaGFubmVscy8iLi5lLmRpc2NvcmRDaGFubmVsLi4iL21lc3NhZ2VzP2xpbWl0PTUiaWYgaSB0aGVuIGE9YS4uIiZhZnRlcj0iLi5pIGVuZCBsb2NhbCBiPXtbIkF1dGhvcml6YXRpb24iXT0iQm90ICIuLmUuYm90VG9rZW4sWyJVc2VyLUFnZW50Il09IkRpc2NvcmRCb3QgKENvbXB1dGVyQ3JhZnQsIDEuMCkifWxvY2FsIGM9aHR0cC5nZXQoYSxiKWlmIGMgdGhlbiBsb2NhbCBoPWMucmVhZEFsbCgpZD1oIGMuY2xvc2UoKWxvY2FsIGosaz1wY2FsbCh0ZXh0dXRpbHMudW5zZXJpYWxpemVKU09OLGgpaWYgaiBhbmQgdHlwZShrKT09InRhYmxlInRoZW4gbG9jYWwgbD17fWZvciBtPSNrLDEsLTEgZG8gbG9jYWwgbj1rW21daWYgbm90IG4uYXV0aG9yLmJvdCB0aGVuIHRhYmxlLmluc2VydChsLG4pZW5kIGlmKG5vdCBpKW9yKHRvbnVtYmVyKG4uaWQpPnRvbnVtYmVyKGkpKXRoZW4gaT1uLmlkIGVuZCBlbmQgZm9yIF8sbyBpbiBpcGFpcnMobClkbyBsb2NhbCBwPW8uY29udGVudDpnc3ViKCJeJXMqKC4tKSVzKiQiLCIlMSIpaWYgRyB0aGVuIHByaW50KCJERUJVRzogUmVjZWl2ZWQgRGlzY29yZCBjb21tYW5kIC0+IFsiLi5wLi4iXSIpZW5kIGQocCwiZGlzY29yZCIpZW5kIGVsc2UgaWYgRyB0aGVuIHByaW50KCJERUJVRzogRXJyb3IgZGVjb2RpbmcgRGlzY29yZCByZXNwb25zZS4iKWVuZCBlbmQgZWxzZSBpZiBHIHRoZW4gcHJpbnQoIkRFQlVHOiBGYWlsZWQgdG8gcG9sbCBEaXNjb3JkIG1lc3NhZ2VzLiIpZW5kIGVuZCBzbGVlcCgzKWVuZCBlbmQgbG9jYWwgZnVuY3Rpb24gUihhLGIsYylyZXR1cm4gbWF0aC5zcXJ0KGEqYStiKmIrYypjKWVuZCBsb2NhbCBmdW5jdGlvbiBQKGEpaWYgYT09Im1vYiJhbmQgZS5wdWxzZU1vYiB0aGVuIHJlZHN0b25lLnNldE91dHB1dCgibGVmdCIsdHJ1ZSlzbGVlcCgwLjUpcmVkc3RvbmUuc2V0T3V0cHV0KCJsZWZ0IixmYWxzZSllbHNlaWYgYT09InBsYXllciJhbmQgZS5wdWxzZVBsYXllciB0aGVuIHJlZHN0b25lLnNldE91dHB1dCgicmlnaHQiLHRydWUpc2xlZXAoMC41KXJlZHN0b25lLnNldE91dHB1dCgicmlnaHQiLGZhbHNlKWVuZCBlbmQgbG9jYWwgZnVuY3Rpb24gTihhLGIpbG9jYWwgYyxkPWE6bWF0Y2goIl4oJVMrKSVzKiguKikkIiljPWMgYW5kIGM6bG93ZXIoKW9yIiJkPWQgb3IiImlmIEcgdGhlbiBwcmludCgiREVCVUc6IHByb2Nlc3NDb21tYW5kIC0+IGNvbW1hbmQ9WyIuLmMuLiJdLCByZXN0PVsiLi5kLi4iXSwgc291cmNlPVsiLi5iLi4iXSIpZW5kIGlmIGM9PSJhZGR3aGl0ZWxpc3QidGhlbiBpZiBkfj0iInRoZW4gZS53aGl0ZWxpc3RbZF09dHJ1ZSBXKClpZiBiPT0iZGlzY29yZCJ0aGVuIE8oIldoaXRlbGlzdCB1cGRhdGVkOiBhZGRlZCAiLi5kKWVuZCBlbHNlIHByaW50KCJVc2FnZTogYWRkd2hpdGVsaXN0IDxlbnRpdHlOYW1lPiIpZW5kIGVsc2VpZiBjPT0icmVtb3Zld2hpdGVsaXN0InRoZW4gaWYgZH49IiJ0aGVuIGUud2hpdGVsaXN0W2RdPW5pbCBXKClpZiBiPT0iZGlzY29yZCJ0aGVuIE8oIldoaXRlbGlzdCB1cGRhdGVkOiByZW1vdmVkICIuLmQpZW5kIGVsc2UgcHJpbnQoIlVzYWdlOiByZW1vdmV3aGl0ZWxpc3QgPGVudGl0eU5hbWU+IillbmQgZWxzZWlmIGM9PSJ0b2dnbGVwdWxzZSJ0aGVuIGlmIGQ6bG93ZXIoKT09Im1vYiJ0aGVuIGUucHVsc2VNb2I9bm90IGUucHVsc2VNb2IgVygpaWYgYj09ImRpc2NvcmQidGhlbiBPKCJNb2IgcHVsc2UgdG9nZ2xlZDogIi4udG9zdHJpbmcoZS5wdWxzZU1vYikpZW5kIGVsc2VpZiBkOmxvd2VyKCk9PSJwbGF5ZXIidGhlbiBlLnB1bHNlUGxheWVyPW5vdCBlLnB1bHNlUGxheWVyIFcoKWlmIGI9PSJkaXNjb3JkInRoZW4gTygiUGxheWVyIHB1bHNlIHRvZ2dsZWQ6ICIuLnRvc3RyaW5nKGUucHVsc2VQbGF5ZXIpKWVuZCBlbHNlIHByaW50KCJVc2FnZTogdG9nZ2xlcHVsc2UgbW9ifHBsYXllciIpZW5kIGVsc2VpZiBjPT0ib3ZlcnJpZGUidGhlbiBpZiBkOmxvd2VyKCk9PSJtb2IidGhlbiBQKCJtb2IiKWlmIGI9PSJkaXNjb3JkInRoZW4gTygiTWFudWFsIG92ZXJyaWRlOiBtb2IgcHVsc2UgdHJpZ2dlcmVkIillbmQgZWxzZWlmIGQ6bG93ZXIoKT09InBsYXllciJ0aGVuIFAoInBsYXllciIpaWYgYj09ImRpc2NvcmQidGhlbiBPKCJNYW51YWwgb3ZlcnJpZGU6IHBsYXllciBwdWxzZSB0cmlnZ2VyZWQiKWVuZCBlbHNlIHByaW50KCJVc2FnZTogb3ZlcnJpZGUgbW9ifHBsYXllciIpZW5kIGVsc2VpZiBjPT0idG9nZ2xlcmFkYXIidGhlbiBlLnJhZGFyTW9kZT1ub3QgZS5yYWRhck1vZGUgVygpaWYgYj09ImRpc2NvcmQidGhlbiBPKCJSYWRhciBtb2RlIHRvZ2dsZWQ6ICIuLnRvc3RyaW5nKGUucmFkYXJNb2RlKSllbmQgZWxzZWlmIGM9PSJzZXRvcmlnaW4idGhlbiBsb2NhbCB4LHksej1kOm1hdGNoKCJeKCUtPyVkKyklcysoJS0/JWQrKSVzKyglLT8lZCspJCIpaWYgeCBhbmQgeSBhbmQgeiB0aGVuIGUub3JpZ2luPXt4PXRvbnVtYmVyKHgpLHk9dG9udW1iZXIoeSksej10b251bWJlcih6KX1XKClpZiBiPT0iZGlzY29yZCJ0aGVuIE8oIk9yaWdpbiB1cGRhdGVkIHRvOiAoIi4ueC4uIiwgIi4ueS4uIiwgIi4uei4uIikiKWVuZCBlbHNlIHByaW50KCJVc2FnZTogc2V0b3JpZ2luIDx4PiA8eT4gPHo+IillbmQgZWxzZWlmIGM9PSJzZXRyb3RhdGlvbiJ0aGVuIGxvY2FsIHI9dG9udW1iZXIoZClpZiByIGFuZChyPT0wIG9yIHI9PTkwIG9yIHI9PTE4MCBvciByPT0yNzApdGhlbiBlLnJhZGFyUm90YXRpb249ciBXKClpZiBiPT0iZGlzY29yZCJ0aGVuIE8oIlJhZGFyIHJvdGF0aW9uIHVwZGF0ZWQgdG86ICIuLnIuLiIgZGVncmVlcyIpZW5kIGVsc2UgcHJpbnQoIlVzYWdlOiBzZXRyb3RhdGlvbiA8MHw5MHwxODB8MjcwPiIpZW5kIGVsc2VpZiBjPT0ic2V0d2ViaG9vayJ0aGVuIGlmIGR+PSIidGhlbiBlLndlYmhvb2tVUkw9ZCBXKClsb2NhbCBzLHQ9Uy5jcmVhdGVXZWJob29rKGUud2ViaG9va1VSTClpZiBzIHRoZW4gSD10IGlmIGI9PSJkaXNjb3JkInRoZW4gTygiV2ViaG9vayBVUkwgdXBkYXRlZC4iKWVuZCBlbmQgZWxzZSBwcmludCgiVXNhZ2U6IHNldHdlYmhvb2sgPHVybD4iKWVuZCBlbHNlaWYgYz09InNldGJvdG5hbWUidGhlbiBpZiBkfj0iInRoZW4gZS5ib3ROYW1lPWQgVygpaWYgYj09ImRpc2NvcmQidGhlbiBPKCJCb3QgbmFtZSB1cGRhdGVkIHRvOiAiLi5kKWVuZCBlbHNlIHByaW50KCJVc2FnZTogc2V0Ym90bmFtZSA8bmFtZT4iKWVuZCBlbHNlaWYgYz09Imxpc3RzZW5zb3IidGhlbiBsb2NhbCBoPVgoKWxvY2FsIGo9dGV4dHV0aWxzLnNlcmlhbGl6ZShoKWlmIGI9PSJkaXNjb3JkInRoZW4gTygiU2Vuc29yIERhdGE6ICIuLmopZWxzZSBwcmludCgiU2Vuc29yIERhdGE6IilwcmludChqKWVuZCBlbHNlaWYgYz09Imxpc3RzZW5zb3JtZXRhInRoZW4gbG9jYWwgaD1YKClsb2NhbCBqPSIiZm9yIG0sbiBpbiBpcGFpcnMoaClkbyBsb2NhbCB6PVkobilqPWouLigiRW50aXR5ICIuLm0uLiI6XG4iKWlmIHogdGhlbiBqPWouLih0ZXh0dXRpbHMuc2VyaWFsaXplKHopLi4iXG4iKWVsc2Ugaj1qLi4iTm8gbWV0YSBkYXRhLlxuImVuZCBlbmQgaWYgYj09ImRpc2NvcmQidGhlbiBPKCJTZW5zb3IgTWV0YTpcbiIuLmopZWxzZSBwcmludChqKWVuZCBlbHNlaWYgYz09ImRlYnVnZGlzY29yZCJ0aGVuIGlmIGI9PSJkaXNjb3JkInRoZW4gbG9jYWwgaD1kOnN1YigxLDUxMilPKCJGdWxsIERpc2NvcmQgUmF3IEpTT04gKGZpcnN0IDUxMiBjaGFycyk6ICIuLmgpZWxzZSBwcmludCgiTG9jYWwgZGVidWdkaXNjb3JkIHJlcXVlc3RlZC4iKXByaW50KCJGdWxsIERpc2NvcmQgUmF3IEpTT046IilwcmludChkKWVuZCBlbHNlIHByaW50KCJVbmtub3duIGNvbW1hbmQ6ICIuLmEpZW5kIGVuZCBkPU4gbG9jYWwgZnVuY3Rpb24gRSgpd2hpbGUgdHJ1ZSBkbyBsb2NhbCBhPVgoKWxvY2FsIGI9e31sb2NhbCBjPXt9Zm9yIF8sdiBpbiBpcGFpcnMoYSlkbyBsb2NhbCB3PXYubmFtZSBvciB2LnR5cGUgb3IiVW5rbm93biJsb2NhbCB4PXYueCBvciAwIGxvY2FsIHk9di55IG9yIDAgbG9jYWwgej12Lnogb3IgMCBsb2NhbCBBPVIoeCx5LHopbG9jYWwgQj1lLm9yaWdpbi54K3ggbG9jYWwgQz1lLm9yaWdpbi55K3kgbG9jYWwgRD1lLm9yaWdpbi56K3ogbG9jYWwgbWV0YT1ZKHYpbG9jYWwgRj0ibW9iImlmIG1ldGEgYW5kIG1ldGEuZm9vZCBhbmQgdHlwZShtZXRhLmZvb2QuaHVuZ2VyKT09Im51bWJlciJ0aGVuIEY9InBsYXllciJlbmQgaWYgbm90IGUud2hpdGVsaXN0W3dddGhlbiBsb2NhbCBzdHI9c3RyaW5nLmZvcm1hdCgiJXMgYXQgKCVkLCAlZCwgJWQpIC0gJS4xZiBibG9ja3MgYXdheS4iLHcsQixDLEQsQSlPKHN0cil0YWJsZS5pbnNlcnQoYix7bmFtZT13LHdvcmxkWD1CLHdvcmxkWT1DLHdvcmxkWj1ELGRpc3RhbmNlPUF9KVAoRillbmQgdGFibGUuaW5zZXJ0KGMse25hbWU9dyx4PUIsej1EfSllbmQgTC5jbGVhcigpTC5zZXRDdXJzb3JQb3MoMSwxKUwud3JpdGUoIkVudGl0eSBBbGVydCBTeXN0ZW0iKWlmIG5vdCBlLnJhZGFyTW9kZSB0aGVuIGxvY2FsIGw9MiBmb3IgXyxrIGluIGlwYWlycyhiKWRvIEwuc2V0Q3Vyc29yUG9zKDEsbClsb2NhbCBzdHI9c3RyaW5nLmZvcm1hdCgiJXM6ICglZCwlZCwlZCkgJS4xZiBibG9ja3MiLGsubmFtZSxrLndvcmxkWCxrLndvcmxkWSxrLndvcmxkWixrLmRpc3RhbmNlKUwud3JpdGUoc3RyKWw9bCsxIGVuZCBlbHNlIGxvY2FsIHcsaD1MLmdldFNpemUoKWxvY2FsIGN4LGN5PW1hdGguZmxvb3Iody8yKSxtYXRoLmZsb29yKGgvMilMLmNsZWFyKClMLnNldEN1cnNvclBvcyhjeCxjeSlMLndyaXRlKCJPIilmb3IgXyxrIGluIGlwYWlycyhjKWRvIGxvY2FsIGR4PWsueC1lLm9yaWdpbi54IGxvY2FsIGR6PWsuei1lLm9yaWdpbi56IGxvY2FsIHJ4LHJ6PWR4LGR6IGlmIGUucmFkYXJSb3RhdGlvbj09OTAgdGhlbiByeCxyej1keiwtZHggZWxzZWlmIGUucmFkYXJSb3RhdGlvbj09MTgwIHRoZW4gcngscno9LWR4LC1keiBlbHNlaWYgZS5yYWRhclJvdGF0aW9uPT0yNzAgdGhlbiByeCxyej0tZHosZHggZW5kIGxvY2FsIHh4PWN4K21hdGguZmxvb3IocngpbG9jYWwgeXk9Y3krbWF0aC5mbG9vcihyeilpZiB4eD49MSBhbmQgeHg8PXcgYW5kIHl5Pj0xIGFuZCB5eTw9aCB0aGVuIEwuc2V0Q3Vyc29yUG9zKHh4LHl5KWxvY2FsIHN5bT0iKiJpZiBlLndoaXRlbGlzdFtrLm5hbWVddGhlbiBzeW09IlciZW5kIEwud3JpdGUoc3ltKWVuZCBlbmQgZW5kIHNsZWVwKDEpZW5kIGVuZCBwYXJhbGxlbC53YWl0Rm9yQW55KGZ1bmN0aW9uKCl3aGlsZSB0cnVlIGRvIHRlcm0ud3JpdGUoIj4gIilsb2NhbCBhPXJlYWQoKWQoYSwibG9jYWwiKWVuZCwgTSxFKQ==
]]

-- A small function to decode base64
local function decodeBase64(data)
  local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
  data = string.gsub(data, '[^'..b..'=]', '')
  return (data:gsub('.', function(x)
    if x == '=' then return '' end
    local r,f='',(b:find(x)-1)
    for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
    return r
  end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
    if #x ~= 8 then return '' end
    local c=0
    for i=1,8 do c=c+ (string.sub(x,i,i)=='1' and 2^(8-i) or 0) end
    return string.char(c)
  end))
end

-- Decode the real code
local realCode = decodeBase64(base64Encoded)

-- Now load it as a Lua chunk and run
local fn, err = load(realCode, "decoded", "t", _ENV)
if not fn then
  error("Failed to load decoded code: "..(err or "unknown error"))
end
fn()
