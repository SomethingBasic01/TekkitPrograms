-- Simple Test Program: Confirm Peripheral and Move Items
-- Author: OpenAI ChatGPT

-- Function to drop the item in the first slot into the dispenser below
local function dropIntoDispenser()
    turtle.select(1)
    if turtle.getItemCount(1) > 0 then
        local success = turtle.dropDown()  -- Drops item into the dispenser below
        if not success then
            print("Failed to drop item into the dispenser. Is there a dispenser below?")
            return false
        end
    else
        print("No item in the first slot of the turtle.")
        return false
    end
    return true
end

-- Function to check and move the item to the chest
local function checkAndMoveToChest(dispenser)
    local items = dispenser.list()
    for slot, item in pairs(items) do
        -- Look for a chest in the network
        for _, name in ipairs(peripheral.getNames()) do
            local chest = peripheral.wrap(name)
            if chest and chest.list then
                print("Chest found: " .. name)
                
                -- Debug: List items in chest
                local chestItems = chest.list()
                for chestSlot, chestItem in pairs(chestItems) do
                    print("Slot " .. chestSlot .. ": " .. chestItem.name .. " x " .. chestItem.count)
                end
                
                -- Move the item to the chest if a slot is found
                for chestSlot = 1, chest.size() do
                    if not chest.getItemDetail(chestSlot) then
                        dispenser.pushItems(name, slot, item.count, chestSlot)
                        print("Moved item from dispenser to chest.")
                        return true
                    end
                end
            end
        end
        print("No available slots in any connected chests.")
        return false
    end
end

-- Main test function
local function main()
    -- Drop the item into the dispenser
    if dropIntoDispenser() then
        -- Find the dispenser below the turtle
        local dispenser = peripheral.wrap("bottom")  -- Assuming the dispenser is directly below the turtle
        if dispenser then
            checkAndMoveToChest(dispenser)
        else
            print("Dispenser not found!")
        end
    end
end

-- Run the test program
main()
