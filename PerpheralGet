-- Function to display table contents
local function printTable(t, indent)
    indent = indent or 0
    local indentStr = string.rep("  ", indent)
    
    for k, v in pairs(t) do
        if type(v) == "table" then
            print(indentStr .. tostring(k) .. ":")
            printTable(v, indent + 1)
        else
            print(indentStr .. tostring(k) .. ": " .. tostring(v))
        end
    end
end

-- Function to list and interact with methods of a peripheral
local function interactWithPeripheral(side)
    if peripheral.isPresent(side) then
        local methods = peripheral.getMethods(side)
        if methods then
            local selected = 1
            local running = true

            while running do
                term.clear()
                term.setCursorPos(1, 1)
                print("Peripheral on side " .. side .. " - Select a method to call:")
                print("Use Up/Down to navigate, Enter to select, Q to quit")
                
                for i, method in ipairs(methods) do
                    if i == selected then
                        print("-> " .. method)
                    else
                        print("   " .. method)
                    end
                end

                -- Wait for user input
                local event, key = os.pullEvent("key")
                
                if key == keys.up then
                    if selected > 1 then
                        selected = selected - 1
                    end
                elseif key == keys.down then
                    if selected < #methods then
                        selected = selected + 1
                    end
                elseif key == keys.enter then
                    term.clear()
                    term.setCursorPos(1, 1)
                    print("Calling method: " .. methods[selected])
                    
                    -- Call the method
                    local result = peripheral.call(side, methods[selected])
                    
                    if type(result) == "table" then
                        print("Method returned a table:")
                        printTable(result)
                    else
                        print("Method returned: " .. tostring(result))
                    end

                    print("\nPress any key to return to the method list.")
                    os.pullEvent("key")
                elseif key == keys.q then
                    running = false
                end
            end
        else
            print("No methods available on peripheral.")
        end
    else
        print("No peripheral on side " .. side)
    end
end

-- Function to select which side to explore
local function selectSide()
    local sides = {"left", "right", "top", "bottom", "front", "back"}
    local selected = 1
    local running = true

    while running do
        term.clear()
        term.setCursorPos(1, 1)
        print("Select a side to explore:")
        print("Use Up/Down to navigate, Enter to select, Q to quit")

        for i, side in ipairs(sides) do
            if i == selected then
                print("-> " .. side)
            else
                print("   " .. side)
            end
        end

        -- Wait for user input
        local event, key = os.pullEvent("key")
        
        if key == keys.up then
            if selected > 1 then
                selected = selected - 1
            end
        elseif key == keys.down then
            if selected < #sides then
                selected = selected + 1
            end
        elseif key == keys.enter then
            interactWithPeripheral(sides[selected])
        elseif key == keys.q then
            running = false
        end
    end
end

-- Run the program
selectSide()
